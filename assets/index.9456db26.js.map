{"version":3,"file":"index.9456db26.js","sources":["../../node_modules/.pnpm/antd-mobile-icons@0.2.2/node_modules/antd-mobile-icons/es/AddOutline.js","../../src/pages/Singer/index.tsx"],"sourcesContent":["import * as React from \"react\";\n\nfunction AddOutline(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    width: \"1em\",\n    height: \"1em\",\n    viewBox: \"0 0 48 48\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\"\n  }, props, {\n    style: Object.assign({\n      verticalAlign: '-0.125em'\n    }, props.style),\n    className: ['antd-mobile-icon', props.className].filter(Boolean).join(' ')\n  }), /*#__PURE__*/React.createElement(\"title\", null, \"33A15659-CFDC-4686-8D0F-7D06C2598A9B@2x\"), /*#__PURE__*/React.createElement(\"g\", {\n    id: \"AddOutline-AddOutline\",\n    stroke: \"none\",\n    strokeWidth: 1,\n    fill: \"none\",\n    fillRule: \"evenodd\"\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"AddOutline-add\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    id: \"AddOutline-\\u77E9\\u5F62\",\n    fill: \"#FFFFFF\",\n    opacity: 0,\n    x: 0,\n    y: 0,\n    width: 48,\n    height: 48\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M25.1,6.5 C25.3209139,6.5 25.5,6.6790861 25.5,6.9 L25.5,22.5 L41.1,22.5 C41.3209139,22.5 41.5,22.6790861 41.5,22.9 L41.5,25.1 C41.5,25.3209139 41.3209139,25.5 41.1,25.5 L25.5,25.5 L25.5,41.1 C25.5,41.3209139 25.3209139,41.5 25.1,41.5 L22.9,41.5 C22.6790861,41.5 22.5,41.3209139 22.5,41.1 L22.5,25.5 L6.9,25.5 C6.6790861,25.5 6.5,25.3209139 6.5,25.1 L6.5,22.9 C6.5,22.6790861 6.6790861,22.5 6.9,22.5 L22.5,22.5 L22.5,6.9 C22.5,6.6790861 22.6790861,6.5 22.9,6.5 L25.1,6.5 Z\",\n    id: \"AddOutline-\\u8DEF\\u5F84\",\n    fill: \"currentColor\",\n    fillRule: \"nonzero\"\n  }))));\n}\n\nexport default AddOutline;","import React, { FC, memo, useCallback, useEffect, useRef, useState } from 'react'\nimport Scroll from \"@/components/Scroll\";\nimport { CSSTransition } from \"react-transition-group\";\nimport \"./index.scss\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { getSingerInfoRequest } from \"@/services/comment\";\nimport Header from \"@/components/Header\";\nimport { AddOutline } from \"antd-mobile-icons\";\nimport SongsList from \"@/components/SongsList\";\n\nconst Singer: FC = function () {\n  const params = useParams<{ id: string }>();\n  const navigate = useNavigate();\n\n  const [showStatus, setShowStatus] = useState(true);\n  const [singer, setSinger] = useState<any>({});\n  const [hotSongs, setHotSongs] = useState([]);\n\n  const imageWrapper = useRef<any>();\n  const collectButton = useRef<any>();\n  const songScrollWrapper = useRef<any>();\n  const songScroll = useRef<any>();\n  const header = useRef<any>();\n  const layer = useRef<any>();\n  const initialHeight = useRef(0);\n\n  useEffect(() => {\n    (async () => {\n      const data = await getSingerInfoRequest(params.id);\n      setSinger(data.artist);\n      setHotSongs(data.hotSongs);\n    })();\n    return () => {\n      setSinger({});\n      setHotSongs([]);\n    };\n  }, [params.id]);\n\n  useEffect(() => {\n    const Dom = imageWrapper.current;\n    Dom.style.background = `url(${singer.picUrl}) no-repeat 0 0% / cover`;\n  }, [singer]);\n\n  //往上偏移的尺寸，露出圆角\n  const OFFSET = 5;\n  const HEADER_HEIGHT = 45;\n\n  useEffect(() => {\n    const h = imageWrapper.current.offsetHeight;\n    initialHeight.current = h;\n    songScrollWrapper.current.style.top = `${h - OFFSET}px`;\n    //把遮罩先放在下面，以裹住歌曲列表\n    layer.current.style.top = `${h - OFFSET}px`;\n    songScroll.current.refresh();\n    // eslint-disable-next-line\n  }, []);\n\n  const handleScroll = useCallback(pos => {\n    const height = initialHeight.current;\n    const newY = pos.y;\n    const imageDOM = imageWrapper.current;\n    const buttonDOM = collectButton.current;\n    const headerDOM = header.current;\n    const layerDOM = layer.current;\n    const minScrollY = -(height - OFFSET) + HEADER_HEIGHT;\n\n    //指的是滑动距离占图片高度的百分比\n    const percent = Math.abs(newY / height);\n\n    if (newY > 0) {\n      imageDOM.style[\"transform\"] = `scale(${1 + percent})`;\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\n      layerDOM.style.top = `${height - OFFSET + newY}px`;\n    } else if (newY >= minScrollY) {\n      layerDOM.style.top = `${height - OFFSET - Math.abs(newY)}px`;\n      //这时候保证遮罩的层叠优先级比图片高，不至于被图片挡住\n      layerDOM.style.zIndex = 1;\n      imageDOM.style.paddingTop = \"75%\";\n      imageDOM.style.height = 0;\n      imageDOM.style.zIndex = -1;\n      //按钮跟着移动且渐渐变透明\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\n      buttonDOM.style[\"opacity\"] = `${1 - percent * 2}`;\n    } else if (newY < minScrollY) {\n      //往上滑动，但是超过Header部分\n      layerDOM.style.top = `${HEADER_HEIGHT - OFFSET}px`;\n      layerDOM.style.zIndex = 1;\n      //防止溢出的歌单内容遮住Header\n      headerDOM.style.zIndex = 100;\n      //此时图片高度与Header一致\n      imageDOM.style.height = `${HEADER_HEIGHT}px`;\n      imageDOM.style.paddingTop = 0;\n      imageDOM.style.zIndex = 99;\n    }\n  }, []);\n\n  return (\n    <CSSTransition\n      in={showStatus}\n      timeout={250}\n      classNames=\"fly\"\n      appear={true}\n      unmountOnExit\n      onExited={() => navigate(-1)}\n    >\n      <div className=\"Container\">\n        <Header\n          ref={header}\n          title={\"歌手\"}\n          isMarquee={false}\n          onClose={() => setShowStatus(false)}\n        />\n        <div className=\"ImgWrapper\" ref={imageWrapper}>\n          <div className=\"filter\" />\n        </div>\n        <div className=\"CollectButton\" ref={collectButton}>\n          <div className=\"iconfont\">\n            <AddOutline />\n          </div>\n          <span className=\"text\">收藏</span>\n        </div>\n        <div className=\"BgLayer\" ref={layer} />\n        <div className=\"SongListWrapper\" ref={songScrollWrapper}>\n          <Scroll ref={songScroll} onScroll={handleScroll}>\n            <div>\n              <SongsList songs={hotSongs} showCollect={false} />\n            </div>\n          </Scroll>\n        </div>\n      </div>\n    </CSSTransition>\n  );\n};\nexport default memo(Singer);\n"],"names":["AddOutline","props","Object","assign","width","height","viewBox","xmlns","xmlnsXlink","style","verticalAlign","className","filter","Boolean","join","react","exports","createElement","React.createElement","id","stroke","strokeWidth","fill","fillRule","opacity","x","y","d","memo","params","useParams","navigate","useNavigate","showStatus","setShowStatus","useState","singer","setSinger","hotSongs","setHotSongs","imageWrapper","useRef","collectButton","songScrollWrapper","songScroll","header","layer","initialHeight","useEffect","data","getSingerInfoRequest","artist","current","background","picUrl","h","offsetHeight","top","refresh","handleScroll","useCallback","pos","newY","imageDOM","buttonDOM","headerDOM","layerDOM","minScrollY","percent","Math","abs","zIndex","paddingTop","React","CSSTransition","in","timeout","classNames","appear","unmountOnExit","onExited","Header","ref","title","isMarquee","onClose","Scroll","onScroll","SongsList","songs","showCollect"],"mappings":"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"}