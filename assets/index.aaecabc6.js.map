{"version":3,"file":"index.aaecabc6.js","sources":["../../src/components/Horizon/index.tsx","../../src/pages/Singers/index.tsx"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport Scroll from \"@/components/Scroll\";\nimport \"./index.scss\";\n\ninterface Props {\n  list: { name: string; key: string }[];\n  oldVal: string;\n  title: string;\n  handleClick: (key: string) => void;\n}\n\nconst Horizon: React.FC<Props> = props => {\n  const { list = [], oldVal = \"\", title = \"\", handleClick = null } = props;\n\n  const listRef = useRef<any>();\n\n  useEffect(() => {\n    const categoryDOM = listRef.current;\n    const tagElems = categoryDOM.querySelectorAll(\"span\");\n    let totalWidth = 0;\n    Array.from(tagElems).forEach(ele => {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      totalWidth += ele.offsetWidth;\n    });\n    categoryDOM.style.width = `${totalWidth}px`;\n  }, []);\n  return (\n    <Scroll direction={\"horizontal\"}>\n      <div className=\"ListItem\" ref={listRef}>\n        <span>{title}</span>\n        {list.map(item => {\n          return (\n            <span\n              onClick={() => {\n                handleClick && handleClick(item.key);\n              }}\n              className={`${oldVal === item.key ? \"selected\" : \"\"}`}\n              key={item.key}\n            >\n              {item.name}\n            </span>\n          );\n        })}\n      </div>\n    </Scroll>\n  );\n};\nexport default Horizon;\n","import React, { FC, memo, useEffect, useState } from \"react\";\nimport Scroll from \"@/components/Scroll\";\nimport styles from \"./singers.module.scss\";\nimport { alphaTypes, categoryTypes } from \"@/utils\";\nimport Horizon from \"@/components/Horizon\";\nimport Loading from \"@/components/Loading\";\nimport { Image } from \"antd-mobile\";\nimport { RootState, useAppDispatch } from \"@/store\";\nimport { useSelector } from \"react-redux\";\nimport {\n  changeEnterLoading,\n  changePageCount,\n  changePullDownLoading,\n  changePullUpLoading,\n  getHotSingerList,\n  getSingerList,\n  refreshMoreHotSingerList,\n  refreshMoreSingerList\n} from \"@/store/singersSlice\";\nimport { Outlet, useNavigate } from \"react-router-dom\";\n\nconst Singers: FC = function () {\n  const [category, setCategory] = useState(\"\");\n  const [alpha, setAlpha] = useState(\"\");\n\n  const { singerList, enterLoading, pullDownLoading, pullUpLoading, pageCount } = useSelector(\n    (state: RootState) => state.singers\n  );\n\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    dispatch(changeEnterLoading(true));\n    dispatch(getSingerList(category, alpha));\n  }, [alpha, category]);\n\n  useEffect(() => {\n    dispatch(changePageCount(0));\n    dispatch(changeEnterLoading(true));\n    dispatch(getHotSingerList());\n  }, []);\n\n  const handleUpdateCategory = (val: string) => {\n    setCategory(val);\n  };\n\n  const handleUpdateAlpha = (val: string) => {\n    setAlpha(val);\n  };\n\n  const changeHotMode = (category: string, alpha: string, hot: boolean) => {\n    if (hot) {\n      dispatch(refreshMoreHotSingerList());\n    } else {\n      dispatch(refreshMoreSingerList(category, alpha));\n    }\n  };\n\n  const handlePullUp = () => {\n    dispatch(changePageCount(pageCount + 30));\n    dispatch(changePullDownLoading(true));\n    if (category === \"\" && alpha === \"\") {\n      changeHotMode(category, alpha, true);\n    } else {\n      changeHotMode(category, alpha, false);\n    }\n  };\n\n  const handlePullDown = () => {\n    dispatch(changePageCount(0));\n    dispatch(changePullUpLoading(true));\n    if (category === \"\" && alpha === \"\") {\n      dispatch(getHotSingerList());\n    } else {\n      dispatch(getSingerList(category, alpha));\n    }\n  };\n\n\n  return (\n    <div>\n      <div className={styles.NavContainer}>\n        <Horizon\n          list={categoryTypes}\n          title={\"分类(默认热门):\"}\n          oldVal={category}\n          handleClick={handleUpdateCategory}\n        />\n        <Horizon\n          list={alphaTypes}\n          oldVal={alpha}\n          title={\"首字母:\"}\n          handleClick={handleUpdateAlpha}\n        />\n      </div>\n      <div className={styles.Container}>\n        <Scroll bounceTop={true} pullUp={handlePullUp} pullDown={handlePullDown}>\n          <div className={styles.ListWrapper}>\n            {singerList.length\n              ? singerList.map((item: any, index: number) => {\n                  return (\n                    <div\n                      key={item.accountId + \"\" + index}\n                      onClick={() => navigate(`/singers/${item.id}`)}\n                      className={styles.ListItem}\n                    >\n                      <div className={styles.ImgWrapper}>\n                        <Image\n                          src={`${item.picUrl}?param=300x300`}\n                          width=\"100%\"\n                          height=\"100%\"\n                          lazy\n                        />\n                      </div>\n                      <span>{item.name}</span>\n                    </div>\n                  );\n                })\n              : null}\n          </div>\n        </Scroll>\n      </div>\n      {enterLoading || pullDownLoading || pullUpLoading ? <Loading /> : null}\n    </div>\n  );\n};\nexport default memo(Singers);\n"],"names":["Horizon","props","list","oldVal","title","handleClick","listRef","useRef","useEffect","categoryDOM","current","tagElems","querySelectorAll","totalWidth","Array","from","forEach","ele","offsetWidth","style","width","React","createElement","Scroll","direction","className","ref","map","item","onClick","key","name","memo","category","setCategory","useState","exports","alpha","setAlpha","singerList","enterLoading","pullDownLoading","pullUpLoading","pageCount","useSelector","state","singers","dispatch","useAppDispatch","navigate","useNavigate","changeEnterLoading","getSingerList","changePageCount","getHotSingerList","changeHotMode","category2","alpha2","hot","refreshMoreHotSingerList","refreshMoreSingerList","styles","categoryTypes","val","alphaTypes","bounceTop","pullUp","changePullDownLoading","pullDown","changePullUpLoading","length","index2","accountId","id","Image","src","picUrl","height","lazy","Loading"],"mappings":"yZAWA,MAAMA,EAAoCC,IAClC,MAAAC,KAAEA,EAAO,UAAIC,EAAS,GAAIC,MAAAA,EAAQ,GAAIC,YAAAA,EAAc,MAASJ,EAE7DK,EAAUC,EAAAA,QAAAA,SAcb,OAZHC,EAAAA,QAAAA,WAAU,KACR,MAAMC,EAAcH,EAAQI,QACtBC,EAAWF,EAAYG,iBAAiB,QAC9C,IAAIC,EAAa,EACjBC,MAAMC,KAAKJ,GAAUK,SAAeC,IAGlCJ,GAAcI,EAAIC,eAERT,EAAAU,MAAMC,MAAQ,GAAGP,QAC5B,IAEAQ,EAAAC,cAAAC,EAAA,CAAOC,UAAW,cAChBH,EAAAC,cAAA,MAAA,CAAIG,UAAU,WAAWC,IAAKpB,mBAC5B,OAAM,KAAAF,GACNF,EAAKyB,KAAYC,GAEbP,EAAAC,cAAA,OAAA,CACCO,QAAS,KACQxB,GAAAA,EAAYuB,EAAKE,MAElCL,UAAW,IAAGtB,IAAWyB,EAAKE,IAAM,WAAa,IACjDA,IAAKF,EAAKE,KAETF,EAAKG,WCuFpB,IAAeC,EAAAA,EAAAA,QAAAA,MA1GK,WAClB,MAAOC,EAAUC,GAAeC,EAAAC,QAAAD,SAAS,KAClCE,EAAOC,GAAYH,EAAAC,QAAAD,SAAS,KAE7BI,WAAEA,EAAYC,aAAAA,EAAAC,gBAAcA,EAAiBC,cAAAA,EAAAC,UAAeA,GAAcC,GAC7EC,GAAqBA,EAAMC,UAGxBC,EAAWC,IACXC,EAAWC,IAEjB1C,EAAAA,QAAAA,WAAU,KACCuC,EAAAI,GAAmB,IACnBJ,EAAAK,EAAcnB,EAAUI,MAChC,CAACA,EAAOJ,IAEXzB,EAAAA,QAAAA,WAAU,KACCuC,EAAAM,EAAgB,IAChBN,EAAAI,GAAmB,IAC5BJ,EAASO,OACR,IAEG,MAQAC,EAAgB,CAACC,EAAkBC,EAAeC,KAEpDX,EADEW,EACOC,IAEAC,EAAsBJ,EAAUC,KA0B3C,SAAAnC,cAAC,WACED,EAAAC,cAAA,MAAA,CAAIG,UAAWoC,GACbxC,EAAAC,cAAAtB,EAAA,CACCE,KAAM4D,EACN1D,MAAO,YACPD,OAAQ8B,EACR5B,YA5CsB0D,IAC5B7B,EAAY6B,MA6CP1C,EAAAC,cAAAtB,EAAA,CACCE,KAAM8D,EACN7D,OAAQkC,EACRjC,MAAO,OACPC,YA9CmB0D,IACzBzB,EAASyB,OAgDN1C,EAAAC,cAAA,MAAA,CAAIG,UAAWoC,GACbxC,EAAAC,cAAAC,EAAA,CAAO0C,WAAW,EAAMC,OAtCV,KACVnB,EAAAM,EAAgBV,EAAY,KAC5BI,EAAAoB,GAAsB,IAEfZ,EAAAtB,EAAUI,EADT,KAAbJ,GAA6B,KAAVI,IAmC4B+B,SA5B9B,KACZrB,EAAAM,EAAgB,IAChBN,EAAAsB,GAAoB,IAE3BtB,EADe,KAAbd,GAA6B,KAAVI,EACZiB,IAEAF,EAAcnB,EAAUI,MAuB5BhB,EAAAC,cAAA,MAAA,CAAIG,UAAWoC,GACbtB,EAAW+B,OACR/B,EAAWZ,KAAI,CAACC,EAAW2C,IAEtBlD,EAAAC,cAAA,MAAA,CACCQ,IAAKF,EAAK4C,UAAY,GAAKD,EAC3B1C,QAAS,IAAMoB,EAAS,YAAYrB,EAAK6C,MACzChD,UAAWoC,GAEVxC,EAAAC,cAAA,MAAA,CAAIG,UAAWoC,GACbxC,EAAAC,cAAAoD,EAAA,CACCC,IAAK,GAAG/C,EAAKgD,uBACbxD,MAAM,OACNyD,OAAO,OACPC,MAAI,KAGRzD,EAAAC,cAAC,OAAM,KAAAM,EAAKG,SAIlB,QAITS,GAAgBC,GAAmBC,EAAgBrB,EAAAC,cAACyD,EAAQ,MAAK"}