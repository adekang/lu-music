var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,i=(e,i)=>{for(var o in i||(i={}))r.call(i,o)&&n(e,o,i[o]);if(t)for(var o of t(i))a.call(i,o)&&n(e,o,i[o]);return e};import{r as o,_ as s,X as l,Y as c,Z as u,m as f,R as m,u as d,w as p,a as v,c as h,$ as y,f as b,b as g,n as E,a0 as x,a1 as k,T as w,V as N,a2 as T,a3 as L,a4 as O,S,J as I}from"./index.43ee1ebf.js";import{H as M}from"./index.5355e585.js";import{a as C,b as R,u as j,d as W,I as _}from"./index.20af472f.js";import{b as $,a as A}from"./bound.9910e1fc.js";import{_ as D,m as U,f as V}from"./music.b374e1f6.js";import"./LeftOutline.81613f0c.js";function z(e){var t=o.exports.useRef(e);t.current=o.exports.useMemo((function(){return e}),[e]);var r=o.exports.useRef();return r.current||(r.current=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.current.apply(this,e)}),r.current}var F=globalThis&&globalThis.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(s){n={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},P=function(){var e=F(o.exports.useState({}),2)[1];return o.exports.useCallback((function(){return e({})}),[])},H=s,K=/\s/;var J=function(e){for(var t=e.length;t--&&K.test(e.charAt(t)););return t},X=/^\s+/;var Y=l,Z=c;var q=function(e){return e?e.slice(0,J(e)+1).replace(X,""):e},B=u,G=function(e){return"symbol"==typeof e||Z(e)&&"[object Symbol]"==Y(e)},Q=/^[-+]0x[0-9a-f]+$/i,ee=/^0b[01]+$/i,te=/^0o[0-7]+$/i,re=parseInt;var ae=u,ne=function(){return H.Date.now()},ie=function(e){if("number"==typeof e)return e;if(G(e))return NaN;if(B(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=B(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=q(e);var r=ee.test(e);return r||te.test(e)?re(e.slice(2),r?2:8):Q.test(e)?NaN:+e},oe=Math.max,se=Math.min;var le=function(e,t,r){var a,n,i,o,s,l,c=0,u=!1,f=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function d(t){var r=a,i=n;return a=n=void 0,c=t,o=e.apply(i,r)}function p(e){return c=e,s=setTimeout(h,t),u?d(e):o}function v(e){var r=e-l;return void 0===l||r>=t||r<0||f&&e-c>=i}function h(){var e=ne();if(v(e))return y(e);s=setTimeout(h,function(e){var r=t-(e-l);return f?se(r,i-(e-c)):r}(e))}function y(e){return s=void 0,m&&a?d(e):(a=n=void 0,o)}function b(){var e=ne(),r=v(e);if(a=arguments,n=this,l=e,r){if(void 0===s)return p(l);if(f)return clearTimeout(s),s=setTimeout(h,t),d(l)}return void 0===s&&(s=setTimeout(h,t)),o}return t=ie(t)||0,ae(r)&&(u=!!r.leading,i=(f="maxWait"in r)?oe(ie(r.maxWait)||0,t):i,m="trailing"in r?!!r.trailing:m),b.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=n=s=void 0},b.flush=function(){return void 0===s?o:y(ne())},b},ce=u;var ue=function(e,t,r){var a=!0,n=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ce(r)&&(a="leading"in r?!!r.leading:a,n="trailing"in r?!!r.trailing:n),le(e,t,{leading:a,maxWait:t,trailing:n})},fe=globalThis&&globalThis.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(s){n={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},me=globalThis&&globalThis.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(fe(arguments[t]));return e};const de={activeLineMode:"auto",stretch:!0};var pe=A((e=>{var t;const r=f(de,e),a=o.exports.useRef(null),n=o.exports.useRef(null),i={};let s=null;const l=[];m.Children.forEach(r.children,((e,t)=>{if(!m.isValidElement(e))return;const r=e.key;if("string"!=typeof r)return;0===t&&(s=r);const a=l.push(e);i[r]=a-1}));const[c,u]=function(e){const{value:t,defaultValue:r,onChange:a}=e,n=P(),i=o.exports.useRef(void 0!==t?t:r);void 0!==t&&(i.current=t);const s=z((e=>{void 0===t&&(i.current=e,n()),null==a||a(e)}));return[i.current,s]}({value:r.activeKey,defaultValue:null!==(t=r.defaultActiveKey)&&void 0!==t?t:s,onChange:e=>{var t;null!==e&&(null===(t=r.onChange)||void 0===t||t.call(r,e))}}),[{x:b,width:g},E]=d((()=>({x:0,width:0,config:{tension:300,clamp:!0}}))),[{scrollLeft:x},k]=d((()=>({scrollLeft:0,config:{tension:300,clamp:!0}}))),[{leftMaskOpacity:w,rightMaskOpacity:N},T]=d((()=>({leftMaskOpacity:0,rightMaskOpacity:0,config:{clamp:!0}})));function L(e=!1){const t=a.current;if(!t)return;const o=i[c];if(void 0===o)return void E.start({x:0,width:0,immediate:!0});const s=n.current;if(!s)return;const l=t.children.item(o+1),u=l.children.item(0),f=u.offsetLeft,m=u.offsetWidth,d=l.offsetLeft,p=l.offsetWidth,v=t.offsetWidth,h=t.scrollWidth,y=t.scrollLeft,b=s.offsetWidth;let g=0,x=0;"auto"===r.activeLineMode?(g=f,x=m):"full"===r.activeLineMode?(g=d,x=p):g=f+(m-b)/2,E.start({x:g,width:x,immediate:e});if(h-v<=0)return;const w=$(f-(v-m)/2,0,h-v);k.start({scrollLeft:w,from:{scrollLeft:y},immediate:e})}j((()=>{L(!b.isAnimating)}),[]),W((()=>{L()}),[c]),function(e,t){const r=z(e);j((()=>{const e=t.current;if(e){if(window.ResizeObserver){const t=new ResizeObserver((()=>{r(e)}));return t.observe(e),()=>{t.disconnect()}}r(e)}}),[t])}((()=>{L(!b.isAnimating)}),a),function(e,t,r){const a=z(e);o.exports.useEffect((()=>{const e=new MutationObserver((()=>{a()}));if(t.current)return e.observe(t.current,r),()=>{e.disconnect()}}),[t])}((()=>{L(!b.isAnimating)}),a,{subtree:!0,childList:!0,characterData:!0});const{run:O}=function(e,t){var r,a=C(e),n=null!==(r=null==t?void 0:t.wait)&&void 0!==r?r:1e3,i=o.exports.useMemo((function(){return ue((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.current.apply(a,me(e))}),n,t)}),[]);return R((function(){i.cancel()})),{run:i,cancel:i.cancel,flush:i.flush}}(((e=!1)=>{const t=a.current;if(!t)return;const r=t.scrollLeft,n=r>0,i=r+t.offsetWidth<t.scrollWidth;T.start({leftMaskOpacity:n?1:0,rightMaskOpacity:i?1:0,immediate:e})}),{wait:100,trailing:!0,leading:!0});return j((()=>{O(!0)}),[]),p(r,m.createElement("div",{className:"adm-tabs"},m.createElement("div",{className:"adm-tabs-header"},m.createElement(v.div,{className:h("adm-tabs-header-mask","adm-tabs-header-mask-left"),style:{opacity:w}}),m.createElement(v.div,{className:h("adm-tabs-header-mask","adm-tabs-header-mask-right"),style:{opacity:N}}),m.createElement(v.div,{className:"adm-tabs-tab-list",ref:a,scrollLeft:x,onScroll:O},m.createElement(v.div,{ref:n,className:"adm-tabs-tab-line",style:{width:"fixed"===r.activeLineMode?"var(--fixed-active-line-width, 30px)":g,x:b}}),l.map((e=>p(e.props,m.createElement("div",{key:e.key,className:h("adm-tabs-tab-wrapper",{"adm-tabs-tab-wrapper-stretch":r.stretch})},m.createElement("div",{onClick:()=>{const{key:t}=e;e.props.disabled||null!=t&&u(t.toString())},className:h("adm-tabs-tab",{"adm-tabs-tab-active":e.key===c,"adm-tabs-tab-disabled":e.props.disabled})},e.props.title))))))),l.map((e=>{if(void 0===e.props.children)return null;const t=e.key===c;return m.createElement(y,{key:e.key,active:t,forceRender:e.props.forceRender,destroyOnClose:e.props.destroyOnClose},m.createElement("div",{className:"adm-tabs-content",style:{display:t?"block":"none"}},e.props.children))}))))}),{Tab:()=>null});const ve=L("cookie");var he=o.exports.memo((e=>{const{loadImg:t=U,imgSrc:r}=e;return m.createElement(m.Fragment,null,m.createElement(D,{placeholder:m.createElement("img",{width:"100%",height:"100%",src:t,alt:"musicLoad"})},m.createElement("img",{src:r,width:"100%",height:"100%",alt:"music"})))}));var ye=m.memo((()=>{o.exports.useEffect((()=>{n()}),[]);const{userInfo:e,loginStates:t}=E((e=>e.login)),r=g(),a=b(),{loginCheck:n}=(()=>{const e=b(),t=g();E((e=>e.login));const[r,a]=o.exports.useState(!1);o.exports.useEffect((()=>{n()}),[]),o.exports.useEffect((()=>{if(r){const t=x("profile");if("undefined"===t)return;e(k({userId:t.userId,nickname:t.nickname,avatarUrl:t.avatarUrl,vipType:t.vipType}))}}),[r]);const n=()=>{void 0!==w.get("cookie")?(e(N(!0)),a(!0)):(T.show({position:"top",content:"用户还没有登录，请登录！"}),e(N(!1)),t("/login"))};return{loginCheck:n}})(),s=e.userId,[l,c]=o.exports.useState([]),[u,f]=o.exports.useState([]),d=o.exports.useRef(),p=o.exports.useRef();o.exports.useEffect((()=>(async function(){if(0!==s)try{const e=await function(e){const t=(new Date).getTime();return O({url:"/user/record",data:i({timestamp:t},e)})}({uid:s,type:1}),{playlist:t}=await function(e){const t=(new Date).getTime();return O({url:"/user/playlist",data:i({timestamp:t,cookie:ve},e)})}({uid:s});c(t),f(e.weekData)}catch(e){return e}}(),()=>{c([]),f([])})),[s]),o.exports.useEffect((()=>{var e;0!==l.length&&(null==(e=d.current)||e.refresh())}),[l]);return m.createElement("div",{className:"userInfoWrapper"},m.createElement(M,{title:"个人中心",onClose:()=>{r("/")}}),t?m.createElement("div",{className:"userInfoContainer"},m.createElement("section",{className:"userInfoHeader"},m.createElement(_,{src:`${e.avatarUrl}?param=150y150`,width:64,height:64,style:{borderRadius:32}}),m.createElement("h1",null,e.nickname)),m.createElement("section",{className:"userTab"},m.createElement(pe,null,m.createElement(pe.Tab,{title:"收藏歌单",key:"fruits"},m.createElement("div",{className:"collectionList"},m.createElement(S,{bounceTop:!0,ref:d,onScroll:V},m.createElement("div",{ref:p},m.createElement(m.Fragment,null,l.length?null==l?void 0:l.map(((e,t)=>{if(0!==t)return m.createElement("div",{key:t,className:"collectionListItem",onClick:()=>r(`/album/${e.id}`)},m.createElement("div",{className:"img_wrapper"},m.createElement(he,{imgSrc:`${e.coverImgUrl}?param=50y50`,loadImg:U})),m.createElement("p",null,e.name))})):null))))),m.createElement(pe.Tab,{title:"最近播放",key:"animals"},m.createElement("div",{className:"collectionList"},m.createElement(S,null,m.createElement("div",null,m.createElement(m.Fragment,null,u.length&&u.map(((e,t)=>m.createElement("div",{key:e.song.id+""+t,className:"collectionListItem",onClick:t=>{return r=Number(e.song.id),void a(I(r));var r}},m.createElement("div",{className:"img_wrapper"},m.createElement(_,{src:`${e.song.al.picUrl}?param=50y50`,lazy:!0})),m.createElement("p",null,e.song.name)))))))))))):null)}));export{ye as default};
//# sourceMappingURL=index.caf25f61.js.map
