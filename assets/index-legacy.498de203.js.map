{"version":3,"file":"index-legacy.498de203.js","sources":["../../src/components/SearchBox/index.tsx","../../src/pages/Search/index.tsx","../../src/assets/singer.png"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport \"./index.scss\";\nimport { debounce } from \"@/utils\";\nimport { LeftOutline } from 'antd-mobile-icons'\n\ninterface Props {\n  back: () => void;\n  newQuery: string;\n  handleQuery: (v: any) => void;\n}\n\n// eslint-disable-next-line react/display-name\nconst SearchBox: React.FC<Props> = props => {\n  const queryRef = useRef<any>();\n  const [query, setQuery] = useState(\"\");\n  // 从父组件热门搜索中拿到的新关键词\n  const { newQuery } = props;\n  // 父组件针对搜索关键字发请求相关的处理\n  const { handleQuery } = props;\n  // 根据关键字是否存在决定清空按钮的显示 / 隐藏\n  const displayStyle = query ? { display: \"block\" } : { display: \"none\" };\n  useEffect(() => {\n    queryRef.current.focus();\n  }, []);\n  const handleChange = (e: any) => {\n    // 搜索框内容改变时的逻辑\n    setQuery(e.currentTarget.value);\n  };\n  const handleQueryDebounce = useMemo(() => {\n    return debounce(handleQuery, 500);\n  }, [handleQuery]);\n  useEffect(() => {\n    // 注意防抖\n    handleQueryDebounce(query);\n  }, [query]);\n\n  useEffect(() => {\n    if (newQuery !== query) {\n      setQuery(newQuery);\n    }\n  }, [newQuery]);\n  const clearQuery = () => {\n    // 清空框内容的逻辑\n    setQuery(\"\");\n    queryRef.current.focus();\n  };\n\n  return (\n    <div className=\"SearchBoxWrapper\">\n      <div className='icon-back' onClick={() => props.back()}>\n        <LeftOutline />\n      </div>\n      <input\n        ref={queryRef}\n        className=\"box\"\n        placeholder=\"搜索歌曲、歌手、专辑\"\n        value={query}\n        onChange={handleChange}\n      />\n      <i className=\"iconfont icon-delete\" onClick={clearQuery} style={displayStyle}>\n        &#xe600;\n      </i>\n    </div>\n  );\n};\n\n// 将ui组件包装成容器组件\nexport default React.memo(SearchBox);\n","import React, { FC, memo, useCallback, useEffect, useState } from \"react\";\nimport { RootState, useAppDispatch } from \"@/store\";\nimport { useSelector } from \"react-redux\";\nimport \"./index.scss\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { useNavigate } from \"react-router-dom\";\nimport Scroll from \"@/components/Scroll\";\nimport Loading from \"@/components/Loading\";\nimport { getName } from \"@/utils\";\nimport LazyLoad, { forceCheck } from \"react-lazyload\";\nimport musicPng from \"@/assets/music.png\";\nimport singerPng from \"@/assets/singer.png\";\nimport { changeEnterLoading, getHotKeyWords, getSuggestList } from \"@/store/searchSlice\";\nimport SearchBox from \"@/components/SearchBox\";\nimport { getSongDetail } from \"@/store/playerSlice\";\n\nconst Search: FC = function () {\n  const { hotList, suggestList, enterLoading, songsList } = useSelector((state: RootState) => {\n    return state.search;\n  });\n\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n\n  const [show, setShow] = useState(false);\n  // 组件内部\n  const [query, setQuery] = useState(\"\");\n\n  useEffect(() => {\n    setShow(true);\n    // 用了 redux 缓存，不再赘述\n    if (!hotList.length) dispatch(getHotKeyWords());\n  }, []);\n\n  const searchBack = useCallback(() => {\n    setShow(false);\n  }, []);\n\n  const handleQuery = (q: any) => {\n    setQuery(q);\n    if (!q) return;\n    dispatch(changeEnterLoading(true));\n    dispatch(getSuggestList(q));\n  };\n\n  const selectItem = (e: React.MouseEvent<HTMLLIElement, MouseEvent>, id: number) => {\n    dispatch(getSongDetail(id));\n  };\n\n  const renderHotKey = () => {\n    const list = hotList ? hotList : [];\n    return (\n      <ul>\n        {list.map(item => {\n          return (\n            <li className=\"item\" key={item.first} onClick={() => setQuery(item.first)}>\n              <span>{item.first}</span>\n            </li>\n          );\n        })}\n      </ul>\n    );\n  };\n  const renderSingers = () => {\n    const singers = suggestList.artists;\n    if (!singers || !singers.length) return;\n    return (\n      <div className=\"SearchList\">\n        <h1 className=\"title\">相关歌手</h1>\n        {singers.map((item, index: number) => {\n          return (\n            <div\n              className=\"SearchListItem\"\n              key={item.accountId + \"\" + index}\n              onClick={() => navigate(`/singers/${item.id}`)}\n            >\n              <div className=\"img_wrapper\">\n                <LazyLoad\n                  placeholder={<img width=\"100%\" height=\"100%\" src={singerPng} alt=\"singer\" />}\n                >\n                  <img src={item.picUrl} width=\"100%\" height=\"100%\" alt=\"music\" />\n                </LazyLoad>\n              </div>\n              <span className=\"name\">歌手: {item.name}</span>\n            </div>\n          );\n        })}\n      </div>\n    );\n  };\n  const renderAlbum = () => {\n    const albums = suggestList.playlists;\n    if (!albums || !albums.length) return;\n    return (\n      <div className=\"SearchList\">\n        <h1 className=\"title\">相关歌单</h1>\n        {albums.map((item, index: number) => {\n          return (\n            <div\n              className=\"SearchListItem\"\n              key={item.accountId + \"\" + index}\n              onClick={() => navigate(`/album/${item.id}`)}\n            >\n              <div className=\"img_wrapper\">\n                <LazyLoad\n                  placeholder={<img width=\"100%\" height=\"100%\" src={musicPng} alt=\"music\" />}\n                >\n                  <img src={item.coverImgUrl} width=\"100%\" height=\"100%\" alt=\"music\" />\n                </LazyLoad>\n              </div>\n              <span className=\"name\">歌单: {item.name}</span>\n            </div>\n          );\n        })}\n      </div>\n    );\n  };\n  const renderSongs = () => {\n    return (\n      <div className=\"SearchSongItem\" style={{ paddingLeft: \"20px\" }}>\n        {songsList.map(\n          (item: {\n            id: number;\n            name: string;\n            artists: any;\n            album: {\n              name: string;\n            };\n          }) => {\n            return (\n              <li key={item.id} onClick={e => selectItem(e, Number(item.id))}>\n                <div className=\"info\">\n                  <span>{item.name}</span>\n                  <span>\n                    {getName(item.artists)} - {item.album.name}\n                  </span>\n                </div>\n              </li>\n            );\n          }\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <CSSTransition\n      in={show}\n      timeout={300}\n      appear={true}\n      classNames=\"fly\"\n      unmountOnExit\n      onExited={() => navigate(-1)}\n    >\n      <div className=\"Container\">\n        <div className=\"search_box_wrapper\">\n          <SearchBox back={searchBack} newQuery={query} handleQuery={handleQuery} />\n        </div>\n        <div className=\"ShortcutWrapper\" style={{ display: `${!query ? \"\" : \"none\"}` }}>\n          <Scroll>\n            <div>\n              <div className=\"HotKey\">\n                <h1 className=\"title\">热门搜索</h1>\n                {renderHotKey()}\n              </div>\n              {/* <SearchHistory>\n                <h1 className=\"title\">\n                  <span className=\"text\">搜索历史</span>\n                  <span className=\"clear\">\n                    <i className=\"iconfont\">&#xe63d;</i>\n                  </span>\n                </h1>\n                {renderHistoryList()}\n              </SearchHistory> */}\n            </div>\n          </Scroll>\n        </div>\n        {/* 下面为搜索结果 */}\n        <div className=\"ShortcutWrapper\" style={{ display: `${query ? \"\" : \"none\"}` }}>\n          <Scroll onScroll={forceCheck}>\n            <div>\n              {renderSingers()}\n              {renderAlbum()}\n              {renderSongs()}\n            </div>\n          </Scroll>\n        </div>\n        {enterLoading ? <Loading /> : null}\n      </div>\n    </CSSTransition>\n  );\n};\nexport default memo(Search);\n","export default \"__VITE_ASSET__a215b051__\""],"names":["SearchBox$1","React","memo","props","queryRef","useRef","useState","exports","query","_react$exports$useSta2","setQuery","newQuery","handleQuery","displayStyle","display","useEffect","current","focus","handleQueryDebounce","useMemo","debounce","createElement","className","onClick","back","LeftOutline","ref","placeholder","value","onChange","e","currentTarget","style","useSelector","state","search","hotList","_useSelector","suggestList","enterLoading","songsList","dispatch","useAppDispatch","navigate","useNavigate","show","_react$exports$useSta4","setShow","_react$exports$useSta6","length","getHotKeyWords","list","searchBack","useCallback","CSSTransition","in","timeout","appear","classNames","unmountOnExit","onExited","SearchBox","q","changeEnterLoading","getSuggestList","concat","Scroll","map","item","key","first","onScroll","forceCheck","singers","artists","index","accountId","id","LazyLoad","width","height","src","alt","picUrl","name","renderSingers","albums","playlists","musicPng","coverImgUrl","renderAlbum","paddingLeft","Number","getSongDetail","getName","album","Loading"],"mappings":"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"}