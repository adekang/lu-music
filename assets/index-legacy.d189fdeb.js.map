{"version":3,"file":"index-legacy.d189fdeb.js","sources":["../../src/pages/Album/index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { getCount, HEADER_HEIGHT, isEmptyObject } from \"@/utils\";\nimport Scroll from \"@/components/Scroll\";\nimport { CSSTransition } from \"react-transition-group\";\nimport SongsList from \"@/components/SongsList\";\nimport Loading from \"@/components/Loading\";\nimport Header from \"@/components/Header\";\nimport { getAlbumDetailRequest } from \"@/services/comment\";\nimport \"./index.scss\";\n\nconst Album: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [showStatus, setShowStatus] = useState(true);\n  const [isMarquee, setIsMarquee] = useState(false);\n  const [title, setTitle] = useState(\"歌单\");\n  const [currentAlbum, setCurrentAlbum] = useState<any>();\n  const [enterLoading, setEnterLoading] = useState<any>(true);\n\n  const headerEl = useRef<any>();\n\n  useEffect(() => {\n    getAlbumDetailRequest(Number(id))\n      .then((res: any) => {\n        const data = res.playlist;\n        setCurrentAlbum(data);\n        setEnterLoading(false);\n      })\n      .catch((err: any) => {\n        setEnterLoading(false);\n        return err;\n      });\n  }, [id]);\n  const handleBack = useCallback(() => {\n    setShowStatus(false);\n  }, []);\n\n  const handleScroll = useCallback(\n    pos => {\n      const minScrollY = -HEADER_HEIGHT;\n      const percent = Math.abs(pos.y / minScrollY);\n      const headerDom = headerEl.current;\n      //滑过顶部的高度开始变化\n      if (pos.y < minScrollY) {\n        headerDom.style.backgroundColor = \"#d44439\";\n        headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\n        setTitle(currentAlbum.name);\n        setIsMarquee(true);\n      } else {\n        headerDom.style.backgroundColor = \"\";\n        headerDom.style.opacity = 1;\n        setTitle(\"歌单\");\n        setIsMarquee(false);\n      }\n    },\n    [currentAlbum]\n  );\n  const renderTopDesc = () => {\n    return (\n      <div\n        className=\"AlbumTopDesc\"\n        style={{\n          background: `url(${currentAlbum.coverImgUrl}),no-repeat`\n        }}\n      >\n        <div className=\"background\">\n          <div className=\"filter\" />\n        </div>\n        <div className=\"img_wrapper\">\n          <div className=\"decorate\" />\n          <img src={currentAlbum.coverImgUrl} alt=\"\" />\n          <div className=\"play_count\">\n            <i className=\"iconfont play\">&#xe885;</i>\n            <span className=\"count\">{getCount(currentAlbum.subscribedCount)}</span>\n          </div>\n        </div>\n        <div className=\"desc_wrapper\">\n          <div className=\"title\">{currentAlbum.name}</div>\n          <div className=\"person\">\n            <div className=\"avatar\">\n              <img src={currentAlbum.creator.avatarUrl} alt=\"\" />\n            </div>\n            <div className=\"name\">{currentAlbum.creator.nickname}</div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderMenu = () => {\n    return (\n      <div className=\"AlbumMenu\">\n        <div>\n          <i className=\"iconfont\">&#xe6ad;</i>\n          评论\n        </div>\n        <div>\n          <i className=\"iconfont\">&#xe86f;</i>\n          点赞\n        </div>\n        <div>\n          <i className=\"iconfont\">&#xe62d;</i>\n          收藏\n        </div>\n        <div>\n          <i className=\"iconfont\">&#xe606;</i>\n          更多\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <CSSTransition\n      in={showStatus}\n      timeout={300}\n      classNames=\"fly\"\n      appear={true}\n      unmountOnExit\n      onExited={() => navigate(-1)}\n    >\n      <div className=\"AlbumContainer\">\n        <Header ref={headerEl} title={title} onClose={handleBack} isMarquee={isMarquee} />\n        <hr />\n        {!isEmptyObject(currentAlbum) ? (\n          <Scroll bounceTop={false} onScroll={handleScroll}>\n            <div>\n              {renderTopDesc()}\n              {renderMenu()}\n              <SongsList\n                songs={currentAlbum.tracks}\n                collectCount={currentAlbum.subscribedCount}\n                showCollect={true}\n                showBackground={true}\n              />\n            </div>\n          </Scroll>\n        ) : null}\n        {enterLoading ? <Loading /> : null}\n      </div>\n    </CSSTransition>\n  );\n};\n\nexport default React.memo(Album);\n"],"names":["exports","React","memo","id","useParams","navigate","useNavigate","_react$exports$useSta2","_slicedToArray","useState","showStatus","setShowStatus","_react$exports$useSta4","isMarquee","setIsMarquee","_react$exports$useSta6","title","setTitle","_react$exports$useSta8","currentAlbum","setCurrentAlbum","enterLoading","setEnterLoading","_react$exports$useSta10","headerEl","useRef","useEffect","getAlbumDetailRequest","Number","then","res","data","playlist","catch","err","handleBack","useCallback","handleScroll","pos","minScrollY","HEADER_HEIGHT","percent","Math","abs","y","headerDom","current","style","backgroundColor","opacity","min","name","createElement","CSSTransition","in","timeout","classNames","appear","unmountOnExit","onExited","className","Header","ref","onClose","isEmptyObject","Scroll","bounceTop","onScroll","background","concat","coverImgUrl","src","alt","getCount","subscribedCount","creator","avatarUrl","nickname","SongsList","songs","tracks","collectCount","showCollect","showBackground","Loading"],"mappings":"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"}