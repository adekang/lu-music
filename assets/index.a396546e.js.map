{"version":3,"file":"index.a396546e.js","sources":["../../src/components/SearchBox/index.tsx","../../src/pages/Search/index.tsx","../../src/assets/singer.png"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport \"./index.scss\";\nimport { debounce } from \"@/utils\";\nimport { LeftOutline } from 'antd-mobile-icons'\n\ninterface Props {\n  back: () => void;\n  newQuery: string;\n  handleQuery: (v: any) => void;\n}\n\n// eslint-disable-next-line react/display-name\nconst SearchBox: React.FC<Props> = props => {\n  const queryRef = useRef<any>();\n  const [query, setQuery] = useState(\"\");\n  // 从父组件热门搜索中拿到的新关键词\n  const { newQuery } = props;\n  // 父组件针对搜索关键字发请求相关的处理\n  const { handleQuery } = props;\n  // 根据关键字是否存在决定清空按钮的显示 / 隐藏\n  const displayStyle = query ? { display: \"block\" } : { display: \"none\" };\n  useEffect(() => {\n    queryRef.current.focus();\n  }, []);\n  const handleChange = (e: any) => {\n    // 搜索框内容改变时的逻辑\n    setQuery(e.currentTarget.value);\n  };\n  const handleQueryDebounce = useMemo(() => {\n    return debounce(handleQuery, 500);\n  }, [handleQuery]);\n  useEffect(() => {\n    // 注意防抖\n    handleQueryDebounce(query);\n  }, [query]);\n\n  useEffect(() => {\n    if (newQuery !== query) {\n      setQuery(newQuery);\n    }\n  }, [newQuery]);\n  const clearQuery = () => {\n    // 清空框内容的逻辑\n    setQuery(\"\");\n    queryRef.current.focus();\n  };\n\n  return (\n    <div className=\"SearchBoxWrapper\">\n      <div className='icon-back' onClick={() => props.back()}>\n        <LeftOutline />\n      </div>\n      <input\n        ref={queryRef}\n        className=\"box\"\n        placeholder=\"搜索歌曲、歌手、专辑\"\n        value={query}\n        onChange={handleChange}\n      />\n      <i className=\"iconfont icon-delete\" onClick={clearQuery} style={displayStyle}>\n        &#xe600;\n      </i>\n    </div>\n  );\n};\n\n// 将ui组件包装成容器组件\nexport default React.memo(SearchBox);\n","import React, { FC, memo, useCallback, useEffect, useState } from \"react\";\nimport { RootState, useAppDispatch } from \"@/store\";\nimport { useSelector } from \"react-redux\";\nimport \"./index.scss\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { useNavigate } from \"react-router-dom\";\nimport Scroll from \"@/components/Scroll\";\nimport Loading from \"@/components/Loading\";\nimport { getName } from \"@/utils\";\nimport LazyLoad, { forceCheck } from \"react-lazyload\";\nimport musicPng from \"@/assets/music.png\";\nimport singerPng from \"@/assets/singer.png\";\nimport { changeEnterLoading, getHotKeyWords, getSuggestList } from \"@/store/searchSlice\";\nimport SearchBox from \"@/components/SearchBox\";\nimport { getSongDetail } from \"@/store/playerSlice\";\n\nconst Search: FC = function () {\n  const { hotList, suggestList, enterLoading, songsList } = useSelector((state: RootState) => {\n    return state.search;\n  });\n\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n\n  const [show, setShow] = useState(false);\n  // 组件内部\n  const [query, setQuery] = useState(\"\");\n\n  useEffect(() => {\n    setShow(true);\n    // 用了 redux 缓存，不再赘述\n    if (!hotList.length) dispatch(getHotKeyWords());\n  }, []);\n\n  const searchBack = useCallback(() => {\n    setShow(false);\n  }, []);\n\n  const handleQuery = (q: any) => {\n    setQuery(q);\n    if (!q) return;\n    dispatch(changeEnterLoading(true));\n    dispatch(getSuggestList(q));\n  };\n\n  const selectItem = (e: React.MouseEvent<HTMLLIElement, MouseEvent>, id: number) => {\n    dispatch(getSongDetail(id));\n  };\n\n  const renderHotKey = () => {\n    const list = hotList ? hotList : [];\n    return (\n      <ul>\n        {list.map(item => {\n          return (\n            <li className=\"item\" key={item.first} onClick={() => setQuery(item.first)}>\n              <span>{item.first}</span>\n            </li>\n          );\n        })}\n      </ul>\n    );\n  };\n  const renderSingers = () => {\n    const singers = suggestList.artists;\n    if (!singers || !singers.length) return;\n    return (\n      <div className=\"SearchList\">\n        <h1 className=\"title\">相关歌手</h1>\n        {singers.map((item, index: number) => {\n          return (\n            <div\n              className=\"SearchListItem\"\n              key={item.accountId + \"\" + index}\n              onClick={() => navigate(`/singers/${item.id}`)}\n            >\n              <div className=\"img_wrapper\">\n                <LazyLoad\n                  placeholder={<img width=\"100%\" height=\"100%\" src={singerPng} alt=\"singer\" />}\n                >\n                  <img src={item.picUrl} width=\"100%\" height=\"100%\" alt=\"music\" />\n                </LazyLoad>\n              </div>\n              <span className=\"name\">歌手: {item.name}</span>\n            </div>\n          );\n        })}\n      </div>\n    );\n  };\n  const renderAlbum = () => {\n    const albums = suggestList.playlists;\n    if (!albums || !albums.length) return;\n    return (\n      <div className=\"SearchList\">\n        <h1 className=\"title\">相关歌单</h1>\n        {albums.map((item, index: number) => {\n          return (\n            <div\n              className=\"SearchListItem\"\n              key={item.accountId + \"\" + index}\n              onClick={() => navigate(`/album/${item.id}`)}\n            >\n              <div className=\"img_wrapper\">\n                <LazyLoad\n                  placeholder={<img width=\"100%\" height=\"100%\" src={musicPng} alt=\"music\" />}\n                >\n                  <img src={item.coverImgUrl} width=\"100%\" height=\"100%\" alt=\"music\" />\n                </LazyLoad>\n              </div>\n              <span className=\"name\">歌单: {item.name}</span>\n            </div>\n          );\n        })}\n      </div>\n    );\n  };\n  const renderSongs = () => {\n    return (\n      <div className=\"SearchSongItem\" style={{ paddingLeft: \"20px\" }}>\n        {songsList.map(\n          (item: {\n            id: number;\n            name: string;\n            artists: any;\n            album: {\n              name: string;\n            };\n          }) => {\n            return (\n              <li key={item.id} onClick={e => selectItem(e, Number(item.id))}>\n                <div className=\"info\">\n                  <span>{item.name}</span>\n                  <span>\n                    {getName(item.artists)} - {item.album.name}\n                  </span>\n                </div>\n              </li>\n            );\n          }\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <CSSTransition\n      in={show}\n      timeout={300}\n      appear={true}\n      classNames=\"fly\"\n      unmountOnExit\n      onExited={() => navigate(-1)}\n    >\n      <div className=\"Container\">\n        <div className=\"search_box_wrapper\">\n          <SearchBox back={searchBack} newQuery={query} handleQuery={handleQuery} />\n        </div>\n        <div className=\"ShortcutWrapper\" style={{ display: `${!query ? \"\" : \"none\"}` }}>\n          <Scroll>\n            <div>\n              <div className=\"HotKey\">\n                <h1 className=\"title\">热门搜索</h1>\n                {renderHotKey()}\n              </div>\n              {/* <SearchHistory>\n                <h1 className=\"title\">\n                  <span className=\"text\">搜索历史</span>\n                  <span className=\"clear\">\n                    <i className=\"iconfont\">&#xe63d;</i>\n                  </span>\n                </h1>\n                {renderHistoryList()}\n              </SearchHistory> */}\n            </div>\n          </Scroll>\n        </div>\n        {/* 下面为搜索结果 */}\n        <div className=\"ShortcutWrapper\" style={{ display: `${query ? \"\" : \"none\"}` }}>\n          <Scroll onScroll={forceCheck}>\n            <div>\n              {renderSingers()}\n              {renderAlbum()}\n              {renderSongs()}\n            </div>\n          </Scroll>\n        </div>\n        {enterLoading ? <Loading /> : null}\n      </div>\n    </CSSTransition>\n  );\n};\nexport default memo(Search);\n","export default \"__VITE_ASSET__a215b051__\""],"names":["SearchBox$1","React","memo","props","queryRef","useRef","query","setQuery","useState","exports","newQuery","handleQuery","displayStyle","display","useEffect","current","focus","handleQueryDebounce","useMemo","debounce","createElement","className","onClick","back","LeftOutline","ref","placeholder","value","onChange","e","currentTarget","style","hotList","suggestList","enterLoading","songsList","useSelector","state","search","dispatch","useAppDispatch","navigate","useNavigate","show","setShow","length","getHotKeyWords","searchBack","useCallback","CSSTransition","in","timeout","appear","classNames","unmountOnExit","onExited","SearchBox","q","changeEnterLoading","getSuggestList","Scroll","list","map","item","key","first","renderHotKey","onScroll","forceCheck","singers","artists","index2","accountId","id","LazyLoad","width","height","src","alt","picUrl","name","renderSingers","albums","playlists","musicPng","coverImgUrl","renderAlbum","paddingLeft","selectItem","Number","getSongDetail","getName","album","Loading"],"mappings":"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"}