{"version":3,"file":"index-legacy.6175c151.js","sources":["../../node_modules/.pnpm/antd-mobile-icons@0.2.2/node_modules/antd-mobile-icons/es/AddOutline.js","../../src/pages/Singer/index.tsx"],"sourcesContent":["import * as React from \"react\";\n\nfunction AddOutline(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    width: \"1em\",\n    height: \"1em\",\n    viewBox: \"0 0 48 48\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\"\n  }, props, {\n    style: Object.assign({\n      verticalAlign: '-0.125em'\n    }, props.style),\n    className: ['antd-mobile-icon', props.className].filter(Boolean).join(' ')\n  }), /*#__PURE__*/React.createElement(\"title\", null, \"33A15659-CFDC-4686-8D0F-7D06C2598A9B@2x\"), /*#__PURE__*/React.createElement(\"g\", {\n    id: \"AddOutline-AddOutline\",\n    stroke: \"none\",\n    strokeWidth: 1,\n    fill: \"none\",\n    fillRule: \"evenodd\"\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"AddOutline-add\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    id: \"AddOutline-\\u77E9\\u5F62\",\n    fill: \"#FFFFFF\",\n    opacity: 0,\n    x: 0,\n    y: 0,\n    width: 48,\n    height: 48\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M25.1,6.5 C25.3209139,6.5 25.5,6.6790861 25.5,6.9 L25.5,22.5 L41.1,22.5 C41.3209139,22.5 41.5,22.6790861 41.5,22.9 L41.5,25.1 C41.5,25.3209139 41.3209139,25.5 41.1,25.5 L25.5,25.5 L25.5,41.1 C25.5,41.3209139 25.3209139,41.5 25.1,41.5 L22.9,41.5 C22.6790861,41.5 22.5,41.3209139 22.5,41.1 L22.5,25.5 L6.9,25.5 C6.6790861,25.5 6.5,25.3209139 6.5,25.1 L6.5,22.9 C6.5,22.6790861 6.6790861,22.5 6.9,22.5 L22.5,22.5 L22.5,6.9 C22.5,6.6790861 22.6790861,6.5 22.9,6.5 L25.1,6.5 Z\",\n    id: \"AddOutline-\\u8DEF\\u5F84\",\n    fill: \"currentColor\",\n    fillRule: \"nonzero\"\n  }))));\n}\n\nexport default AddOutline;","import React, { FC, memo, useCallback, useEffect, useRef, useState } from 'react'\nimport Scroll from \"@/components/Scroll\";\nimport { CSSTransition } from \"react-transition-group\";\nimport \"./index.scss\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { getSingerInfoRequest } from \"@/services/comment\";\nimport Header from \"@/components/Header\";\nimport { AddOutline } from \"antd-mobile-icons\";\nimport SongsList from \"@/components/SongsList\";\n\nconst Singer: FC = function () {\n  const params = useParams<{ id: string }>();\n  const navigate = useNavigate();\n\n  const [showStatus, setShowStatus] = useState(true);\n  const [singer, setSinger] = useState<any>({});\n  const [hotSongs, setHotSongs] = useState([]);\n\n  const imageWrapper = useRef<any>();\n  const collectButton = useRef<any>();\n  const songScrollWrapper = useRef<any>();\n  const songScroll = useRef<any>();\n  const header = useRef<any>();\n  const layer = useRef<any>();\n  const initialHeight = useRef(0);\n\n  useEffect(() => {\n    (async () => {\n      const data = await getSingerInfoRequest(params.id);\n      setSinger(data.artist);\n      setHotSongs(data.hotSongs);\n    })();\n    return () => {\n      setSinger({});\n      setHotSongs([]);\n    };\n  }, [params.id]);\n\n  useEffect(() => {\n    const Dom = imageWrapper.current;\n    Dom.style.background = `url(${singer.picUrl}) no-repeat 0 0% / cover`;\n  }, [singer]);\n\n  //往上偏移的尺寸，露出圆角\n  const OFFSET = 5;\n  const HEADER_HEIGHT = 45;\n\n  useEffect(() => {\n    const h = imageWrapper.current.offsetHeight;\n    initialHeight.current = h;\n    songScrollWrapper.current.style.top = `${h - OFFSET}px`;\n    //把遮罩先放在下面，以裹住歌曲列表\n    layer.current.style.top = `${h - OFFSET}px`;\n    songScroll.current.refresh();\n    // eslint-disable-next-line\n  }, []);\n\n  const handleScroll = useCallback(pos => {\n    const height = initialHeight.current;\n    const newY = pos.y;\n    const imageDOM = imageWrapper.current;\n    const buttonDOM = collectButton.current;\n    const headerDOM = header.current;\n    const layerDOM = layer.current;\n    const minScrollY = -(height - OFFSET) + HEADER_HEIGHT;\n\n    //指的是滑动距离占图片高度的百分比\n    const percent = Math.abs(newY / height);\n\n    if (newY > 0) {\n      imageDOM.style[\"transform\"] = `scale(${1 + percent})`;\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\n      layerDOM.style.top = `${height - OFFSET + newY}px`;\n    } else if (newY >= minScrollY) {\n      layerDOM.style.top = `${height - OFFSET - Math.abs(newY)}px`;\n      //这时候保证遮罩的层叠优先级比图片高，不至于被图片挡住\n      layerDOM.style.zIndex = 1;\n      imageDOM.style.paddingTop = \"75%\";\n      imageDOM.style.height = 0;\n      imageDOM.style.zIndex = -1;\n      //按钮跟着移动且渐渐变透明\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\n      buttonDOM.style[\"opacity\"] = `${1 - percent * 2}`;\n    } else if (newY < minScrollY) {\n      //往上滑动，但是超过Header部分\n      layerDOM.style.top = `${HEADER_HEIGHT - OFFSET}px`;\n      layerDOM.style.zIndex = 1;\n      //防止溢出的歌单内容遮住Header\n      headerDOM.style.zIndex = 100;\n      //此时图片高度与Header一致\n      imageDOM.style.height = `${HEADER_HEIGHT}px`;\n      imageDOM.style.paddingTop = 0;\n      imageDOM.style.zIndex = 99;\n    }\n  }, []);\n\n  return (\n    <CSSTransition\n      in={showStatus}\n      timeout={250}\n      classNames=\"fly\"\n      appear={true}\n      unmountOnExit\n      onExited={() => navigate(-1)}\n    >\n      <div className=\"Container\">\n        <Header\n          ref={header}\n          title={\"歌手\"}\n          isMarquee={false}\n          onClose={() => setShowStatus(false)}\n        />\n        <div className=\"ImgWrapper\" ref={imageWrapper}>\n          <div className=\"filter\" />\n        </div>\n        <div className=\"CollectButton\" ref={collectButton}>\n          <div className=\"iconfont\">\n            <AddOutline />\n          </div>\n          <span className=\"text\">收藏</span>\n        </div>\n        <div className=\"BgLayer\" ref={layer} />\n        <div className=\"SongListWrapper\" ref={songScrollWrapper}>\n          <Scroll ref={songScroll} onScroll={handleScroll}>\n            <div>\n              <SongsList songs={hotSongs} showCollect={false} />\n            </div>\n          </Scroll>\n        </div>\n      </div>\n    </CSSTransition>\n  );\n};\nexport default memo(Singer);\n"],"names":["AddOutline","props","React.createElement","Object","assign","width","height","viewBox","xmlns","xmlnsXlink","style","verticalAlign","className","filter","Boolean","join","exports","createElement","id","stroke","strokeWidth","fill","fillRule","opacity","x","y","d","memo","params","useParams","navigate","useNavigate","_react$exports$useSta2","_slicedToArray","useState","showStatus","setShowStatus","singer","setSinger","_react$exports$useSta4","hotSongs","setHotSongs","imageWrapper","useRef","collectButton","songScrollWrapper","songScroll","header","layer","initialHeight","useEffect","regeneratorRuntime","mark","getSingerInfoRequest","data","artist","_context","stop","_callee","current","background","concat","picUrl","h","offsetHeight","top","refresh","handleScroll","useCallback","pos","newY","imageDOM","buttonDOM","headerDOM","layerDOM","minScrollY","percent","Math","abs","zIndex","paddingTop","HEADER_HEIGHT","React","CSSTransition","in","timeout","classNames","appear","unmountOnExit","onExited","Header","ref","title","isMarquee","onClose","Scroll","onScroll","SongsList","songs","showCollect"],"mappings":"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"}