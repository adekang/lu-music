{"version":3,"file":"index.e607e8f0.js","sources":["../../src/pages/Album/index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { getCount, HEADER_HEIGHT, isEmptyObject } from \"@/utils\";\nimport Scroll from \"@/components/Scroll\";\nimport { CSSTransition } from \"react-transition-group\";\nimport SongsList from \"@/components/SongsList\";\nimport Loading from \"@/components/Loading\";\nimport Header from \"@/components/Header\";\nimport { getAlbumDetailRequest } from \"@/services/comment\";\nimport \"./index.scss\";\n\nconst Album: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [showStatus, setShowStatus] = useState(true);\n  const [isMarquee, setIsMarquee] = useState(false);\n  const [title, setTitle] = useState(\"歌单\");\n  const [currentAlbum, setCurrentAlbum] = useState<any>();\n  const [enterLoading, setEnterLoading] = useState<any>(true);\n\n  const headerEl = useRef<any>();\n\n  useEffect(() => {\n    getAlbumDetailRequest(Number(id))\n      .then((res: any) => {\n        const data = res.playlist;\n        setCurrentAlbum(data);\n        setEnterLoading(false);\n      })\n      .catch((err: any) => {\n        setEnterLoading(false);\n        return err;\n      });\n  }, [id]);\n  const handleBack = useCallback(() => {\n    setShowStatus(false);\n  }, []);\n\n  const handleScroll = useCallback(\n    pos => {\n      const minScrollY = -HEADER_HEIGHT;\n      const percent = Math.abs(pos.y / minScrollY);\n      const headerDom = headerEl.current;\n      //滑过顶部的高度开始变化\n      if (pos.y < minScrollY) {\n        headerDom.style.backgroundColor = \"#d44439\";\n        headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\n        setTitle(currentAlbum.name);\n        setIsMarquee(true);\n      } else {\n        headerDom.style.backgroundColor = \"\";\n        headerDom.style.opacity = 1;\n        setTitle(\"歌单\");\n        setIsMarquee(false);\n      }\n    },\n    [currentAlbum]\n  );\n  const renderTopDesc = () => {\n    return (\n      <div\n        className=\"AlbumTopDesc\"\n        style={{\n          background: `url(${currentAlbum.coverImgUrl}),no-repeat`\n        }}\n      >\n        <div className=\"background\">\n          <div className=\"filter\" />\n        </div>\n        <div className=\"img_wrapper\">\n          <div className=\"decorate\" />\n          <img src={currentAlbum.coverImgUrl} alt=\"\" />\n          <div className=\"play_count\">\n            <i className=\"iconfont play\">&#xe885;</i>\n            <span className=\"count\">{getCount(currentAlbum.subscribedCount)}</span>\n          </div>\n        </div>\n        <div className=\"desc_wrapper\">\n          <div className=\"title\">{currentAlbum.name}</div>\n          <div className=\"person\">\n            <div className=\"avatar\">\n              <img src={currentAlbum.creator.avatarUrl} alt=\"\" />\n            </div>\n            <div className=\"name\">{currentAlbum.creator.nickname}</div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderMenu = () => {\n    return (\n      <div className=\"AlbumMenu\">\n        <div>\n          <i className=\"iconfont\">&#xe6ad;</i>\n          评论\n        </div>\n        <div>\n          <i className=\"iconfont\">&#xe86f;</i>\n          点赞\n        </div>\n        <div>\n          <i className=\"iconfont\">&#xe62d;</i>\n          收藏\n        </div>\n        <div>\n          <i className=\"iconfont\">&#xe606;</i>\n          更多\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <CSSTransition\n      in={showStatus}\n      timeout={300}\n      classNames=\"fly\"\n      appear={true}\n      unmountOnExit\n      onExited={() => navigate(-1)}\n    >\n      <div className=\"AlbumContainer\">\n        <Header ref={headerEl} title={title} onClose={handleBack} isMarquee={isMarquee} />\n        <hr />\n        {!isEmptyObject(currentAlbum) ? (\n          <Scroll bounceTop={false} onScroll={handleScroll}>\n            <div>\n              {renderTopDesc()}\n              {renderMenu()}\n              <SongsList\n                songs={currentAlbum.tracks}\n                collectCount={currentAlbum.subscribedCount}\n                showCollect={true}\n                showBackground={true}\n              />\n            </div>\n          </Scroll>\n        ) : null}\n        {enterLoading ? <Loading /> : null}\n      </div>\n    </CSSTransition>\n  );\n};\n\nexport default React.memo(Album);\n"],"names":["index","React","memo","id","useParams","navigate","useNavigate","showStatus","setShowStatus","useState","exports","isMarquee","setIsMarquee","title","setTitle","currentAlbum","setCurrentAlbum","enterLoading","setEnterLoading","headerEl","useRef","useEffect","getAlbumDetailRequest","Number","then","res","data","playlist","catch","err","handleBack","useCallback","handleScroll","pos","minScrollY","HEADER_HEIGHT","percent","Math","abs","y","headerDom","current","style","backgroundColor","opacity","min","name","createElement","CSSTransition","in","timeout","classNames","appear","unmountOnExit","onExited","className","Header","ref","onClose","isEmptyObject","Scroll","bounceTop","onScroll","background","coverImgUrl","src","alt","getCount","subscribedCount","creator","avatarUrl","nickname","SongsList","songs","tracks","collectCount","showCollect","showBackground","Loading"],"mappings":"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"}